FROM registry.access.redhat.com/ubi8/python-39:latest

# Install dependencies
RUN pip3 install --no-cache-dir flask

# Set working directory (creates directory automatically)
WORKDIR /app

# Create application file
RUN echo 'from flask import Flask, jsonify' > app.py && \
    echo 'import os' >> app.py && \
    echo '' >> app.py && \
    echo 'app = Flask(__name__)' >> app.py && \
    echo '' >> app.py && \
    echo '@app.route("/")' >> app.py && \
    echo 'def health():' >> app.py && \
    echo '    return jsonify({' >> app.py && \
    echo '        "status": "healthy",' >> app.py && \
    echo '        "service": "compliance-report-generator",' >> app.py && \
    echo '        "aws_connector": os.getenv("AWS_CONNECTOR_URL", ""),' >> app.py && \
    echo '        "azure_connector": os.getenv("AZURE_CONNECTOR_URL", "")' >> app.py && \
    echo '    })' >> app.py && \
    echo '' >> app.py && \
    echo '@app.route("/api/generate", methods=["POST"])' >> app.py && \
    echo 'def generate():' >> app.py && \
    echo '    return jsonify({' >> app.py && \
    echo '        "status": "success",' >> app.py && \
    echo '        "report_id": "20240115",' >> app.py && \
    echo '        "location": "/reports/compliance-report-20240115.pdf"' >> app.py && \
    echo '    })' >> app.py && \
    echo '' >> app.py && \
    echo 'if __name__ == "__main__":' >> app.py && \
    echo '    app.run(host="0.0.0.0", port=8080)' >> app.py

EXPOSE 8080

CMD ["python3", "app.py"]
